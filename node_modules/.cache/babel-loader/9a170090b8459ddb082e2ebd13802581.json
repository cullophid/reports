{"ast":null,"code":"import _objectSpread from \"/Users/andreas/code/reports/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _slicedToArray from \"/Users/andreas/code/reports/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/andreas/code/reports/app/src/components/ReportEditor/TextElement.tsx\";\nimport React, { useState, useEffect } from \"react\";\nimport styled from \"react-emotion\";\nimport { textElement } from \"../../models/reports\";\nimport * as Theme from \"../../theme\";\nimport TextEditor from \"../TextEditor\";\nimport { DragHandle } from \"../DragHandle\";\nexport var TextElement = function TextElement(props) {\n  var _useState = useState({\n    pressed: null\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      state = _useState2[0],\n      setState = _useState2[1];\n\n  var onDragStart = function onDragStart(e) {\n    setState({\n      pressed: {\n        x: e.clientX,\n        y: e.clientY\n      }\n    });\n  };\n\n  var onMouseUp = function onMouseUp() {\n    setState({\n      pressed: null\n    });\n  };\n\n  var onMouseDown = function onMouseDown(e) {\n    var scale = props.scale,\n        onClick = props.onClick,\n        edit = props.edit;\n    e.stopPropagation();\n    if (edit) return;\n    setState({\n      pressed: {\n        x: e.clientX,\n        y: e.clientY\n      }\n    });\n    onClick && onClick();\n  };\n\n  var onMouseMove = function onMouseMove(e) {\n    var textElement = props.textElement,\n        scale = props.scale,\n        onUpdate = props.onUpdate,\n        edit = props.edit;\n    var pressed = state.pressed;\n    if (!pressed || edit) return;\n    var x = (e.clientX - pressed.x) / scale;\n    var y = (e.clientY - pressed.y) / scale;\n    onUpdate(_objectSpread({}, textElement, {\n      x: textElement.x + x,\n      y: textElement.y + y\n    }));\n    setState({\n      pressed: {\n        x: e.clientX,\n        y: e.clientY\n      }\n    });\n  };\n\n  useEffect(function () {\n    document.addEventListener(\"mouseup\", onMouseUp);\n    return function () {\n      return document.removeEventListener(\"mouseup\", onMouseUp);\n    };\n  });\n  var textElement = props.textElement,\n      scale = props.scale;\n  return React.createElement(BoundingBox, {\n    style: {\n      left: textElement.x,\n      top: textElement.y,\n      width: textElement.width,\n      border: props.edit ? \"1px dashed \".concat(Theme.primary) : props.selected ? \"1px solid \".concat(Theme.primary) : \"1px solid transparent\"\n    },\n    key: textElement.id,\n    onDoubleClick: props.onDoubleClick,\n    onMouseDown: onMouseDown,\n    onMouseMove: onMouseMove,\n    onClick: props.onClick,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89\n    },\n    __self: this\n  }, props.edit ? React.createElement(Text, {\n    style: {\n      fontSize: textElement.text.fontSize,\n      textAlign: textElement.text.align.toLowerCase()\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }, React.createElement(TextEditor, {\n    defaultValue: textElement.text.value,\n    onSave: function onSave(value) {\n      return props.onUpdate(_objectSpread({}, textElement, {\n        text: _objectSpread({}, textElement.text, {\n          value: value\n        })\n      }));\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113\n    },\n    __self: this\n  })) : React.createElement(Text, {\n    style: {\n      fontSize: textElement.text.fontSize,\n      textAlign: textElement.text.align.toLowerCase(),\n      border: \"1px solid \".concat(props.selected ? Theme.primary : \"transparent\")\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }, textElement.text.value), props.selected && !props.edit && React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137\n    },\n    __self: this\n  }, React.createElement(DragHandle, {\n    onDrag: function onDrag(_ref) {\n      var x = _ref.x,\n          y = _ref.y;\n      props.onUpdate(_objectSpread({}, textElement, {\n        x: textElement.x + x / scale,\n        width: textElement.width - x / scale\n      }));\n    },\n    style: {\n      left: 0,\n      top: \"50%\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138\n    },\n    __self: this\n  }), React.createElement(DragHandle, {\n    onDrag: function onDrag(_ref2) {\n      var x = _ref2.x;\n      props.onUpdate(_objectSpread({}, textElement, {\n        width: Math.max(1, textElement.width + x / scale)\n      }));\n    },\n    style: {\n      top: \"50%\",\n      right: 0\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  })));\n};\nvar BoundingBox =\n/*#__PURE__*/\nstyled(\"div\", {\n  label: \"BoundingBox\",\n  target: \"e10ondmu0\"\n})(\"position:absolute;\");\nvar Text =\n/*#__PURE__*/\nstyled(\"div\", {\n  label: \"Text\",\n  target: \"e10ondmu1\"\n})(\"cursor:pointer;margin:0;font-family:\\\"Montserrat\\\",sans-serif;border:1px solid transparent;background:none;border:none;width:100%;min-height:20px;&:focus{outline:none;}\");","map":{"version":3,"sources":["/Users/andreas/code/reports/app/src/components/ReportEditor/TextElement.tsx"],"names":["React","useState","useEffect","styled","textElement","Theme","TextEditor","DragHandle","TextElement","props","pressed","state","setState","onDragStart","e","x","clientX","y","clientY","onMouseUp","onMouseDown","scale","onClick","edit","stopPropagation","onMouseMove","onUpdate","document","addEventListener","removeEventListener","left","top","width","border","primary","selected","id","onDoubleClick","fontSize","text","textAlign","align","toLowerCase","value","Math","max","right","BoundingBox","Text"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport styled from \"react-emotion\";\nimport { textElement } from \"../../models/reports\";\nimport * as Theme from \"../../theme\";\nimport TextEditor from \"../TextEditor\";\nimport { DragHandle } from \"../DragHandle\";\n\ntype pos = {\n  x: number;\n  y: number;\n};\n\ntype BoundingBox = {\n  selected: boolean;\n  edit: boolean;\n  width: number;\n  x: number;\n  y: number;\n};\n\ntype props = {\n  scale: number;\n  textElement: textElement;\n  selected: boolean;\n  edit: boolean;\n  onUpdate: (element: textElement) => void;\n  onClick: () => void;\n  onDoubleClick: () => void;\n};\n\ntype state = {\n  pressed: { x: number; y: number } | null;\n};\n\nexport const TextElement = (props: props) => {\n  const [state, setState] = useState<state>({ pressed: null });\n  const onDragStart = (e: MouseEvent) => {\n    setState({\n      pressed: {\n        x: e.clientX,\n        y: e.clientY\n      }\n    });\n  };\n\n  const onMouseUp = () => {\n    setState({ pressed: null });\n  };\n\n  const onMouseDown = (e: React.MouseEvent) => {\n    const { scale, onClick, edit } = props;\n    e.stopPropagation();\n    if (edit) return;\n    setState({\n      pressed: {\n        x: e.clientX,\n        y: e.clientY\n      }\n    });\n    onClick && onClick();\n  };\n\n  const onMouseMove = (e: React.MouseEvent) => {\n    const { textElement, scale, onUpdate, edit } = props;\n    const { pressed } = state;\n    if (!pressed || edit) return;\n    const x = (e.clientX - pressed.x) / scale;\n    const y = (e.clientY - pressed.y) / scale;\n    onUpdate({\n      ...textElement,\n      x: textElement.x + x,\n      y: textElement.y + y\n    });\n    setState({\n      pressed: {\n        x: e.clientX,\n        y: e.clientY\n      }\n    });\n  };\n\n  useEffect(() => {\n    document.addEventListener(\"mouseup\", onMouseUp);\n    return () => document.removeEventListener(\"mouseup\", onMouseUp);\n  });\n\n  const { textElement, scale } = props;\n  return (\n    <BoundingBox\n      style={{\n        left: textElement.x,\n        top: textElement.y,\n        width: textElement.width,\n        border: props.edit\n          ? `1px dashed ${Theme.primary}`\n          : props.selected\n          ? `1px solid ${Theme.primary}`\n          : \"1px solid transparent\"\n      }}\n      key={textElement.id}\n      onDoubleClick={props.onDoubleClick}\n      onMouseDown={onMouseDown}\n      onMouseMove={onMouseMove}\n      onClick={props.onClick}\n    >\n      {props.edit ? (\n        <Text\n          style={{\n            fontSize: textElement.text.fontSize,\n            textAlign: textElement.text.align.toLowerCase() as any\n          }}\n        >\n          <TextEditor\n            defaultValue={textElement.text.value}\n            onSave={(value) =>\n              props.onUpdate({\n                ...textElement,\n                text: { ...textElement.text, value }\n              })\n            }\n          />\n        </Text>\n      ) : (\n        <Text\n          style={{\n            fontSize: textElement.text.fontSize,\n            textAlign: textElement.text.align.toLowerCase() as any,\n            border: `1px solid ${\n              props.selected ? Theme.primary : \"transparent\"\n            }`\n          }}\n        >\n          {textElement.text.value}\n        </Text>\n      )}\n      {props.selected && !props.edit && (\n        <React.Fragment>\n          <DragHandle\n            onDrag={({ x, y }) => {\n              props.onUpdate({\n                ...textElement,\n                x: textElement.x + x / scale,\n                width: textElement.width - x / scale\n              });\n            }}\n            style={{\n              left: 0,\n              top: \"50%\"\n            }}\n          />\n          <DragHandle\n            onDrag={({ x }) => {\n              props.onUpdate({\n                ...textElement,\n                width: Math.max(1, textElement.width + x / scale)\n              });\n            }}\n            style={{\n              top: \"50%\",\n              right: 0\n            }}\n          />\n        </React.Fragment>\n      )}\n    </BoundingBox>\n  );\n};\n\nconst BoundingBox = styled.div`\n  position: absolute;\n`;\n\nconst Text = styled.div`\n  cursor: pointer;\n  margin: 0;\n  font-family: \"Montserrat\", sans-serif;\n  border: 1px solid transparent;\n  background: none;\n  border: none;\n  width: 100%;\n  min-height: 20px;\n  &:focus {\n    outline: none;\n  }\n`;\n"]},"metadata":{},"sourceType":"module"}
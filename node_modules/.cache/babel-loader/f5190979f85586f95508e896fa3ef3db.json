{"ast":null,"code":"import _objectSpread from \"/Users/andreas/code/reports/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _slicedToArray from \"/Users/andreas/code/reports/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/andreas/code/reports/app/src/components/ReportEditor/TextElement.tsx\";\nimport React, { useState } from \"react\";\nimport styled from \"react-emotion\";\nimport { textElement } from \"../../models/reports\";\nimport * as Theme from \"../../theme\";\nimport TextEditor from \"../TextEditor\";\nimport { DragHandle } from \"../DragHandle\";\nimport { useDrag } from \"../../hooks/mouse\";\nexport var TextElement = function TextElement(props) {\n  var _useState = useState({\n    pressed: null\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      state = _useState2[0],\n      setState = _useState2[1];\n\n  var onDragStart = function onDragStart(e) {\n    setState({\n      pressed: {\n        x: e.clientX,\n        y: e.clientY\n      }\n    });\n  };\n\n  var onDrag = function onDrag(e) {\n    var textElement = props.textElement,\n        scale = props.scale,\n        onUpdate = props.onUpdate,\n        edit = props.edit;\n    var pressed = state.pressed;\n    if (!pressed || edit) return;\n    var x = (e.clientX - pressed.x) / scale;\n    var y = (e.clientY - pressed.y) / scale;\n    onUpdate(_objectSpread({}, textElement, {\n      x: textElement.x + x,\n      y: textElement.y + y\n    }));\n    setState({\n      pressed: {\n        x: e.clientX,\n        y: e.clientY\n      }\n    });\n  };\n\n  var onDragEnd = function onDragEnd() {\n    setState({\n      pressed: null\n    });\n    props.onClick && props.onClick();\n  }; // const onMouseDown = (e: React.MouseEvent) => {\n  //   const { scale, onClick, edit } = props;\n  //   e.stopPropagation();\n  //   if (edit) return;\n  //   setState({\n  //     pressed: {\n  //       x: e.clientX,\n  //       y: e.clientY\n  //     }\n  //   });\n  //   onClick && onClick();\n  // };\n  // const onMouseMove = (e: React.MouseEvent) => {\n  //   const { textElement, scale, onUpdate, edit } = props;\n  //   const { pressed } = state;\n  //   if (!pressed || edit) return;\n  //   const x = (e.clientX - pressed.x) / scale;\n  //   const y = (e.clientY - pressed.y) / scale;\n  //   onUpdate({\n  //     ...textElement,\n  //     x: textElement.x + x,\n  //     y: textElement.y + y\n  //   });\n  //   setState({\n  //     pressed: {\n  //       x: e.clientX,\n  //       y: e.clientY\n  //     }\n  //   });\n  // };\n  // useEffect(() => {\n  //   document.addEventListener(\"mouseup\", onMouseUp);\n  //   return () => document.removeEventListener(\"mouseup\", onMouseUp);\n  // });\n\n\n  var textElement = props.textElement,\n      scale = props.scale;\n  return React.createElement(BoundingBox, Object.assign({\n    style: {\n      left: textElement.x,\n      top: textElement.y,\n      width: textElement.width,\n      border: props.edit ? \"1px dashed \".concat(Theme.primary) : props.selected ? \"1px solid \".concat(Theme.primary) : \"1px solid transparent\"\n    },\n    key: textElement.id,\n    onDoubleClick: props.onDoubleClick\n  }, useDrag({\n    onDragStart: onDragStart,\n    onDragEnd: onDragEnd,\n    onDrag: onDrag\n  }), {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110\n    },\n    __self: this\n  }), props.edit ? React.createElement(Text, {\n    style: {\n      fontSize: textElement.text.fontSize,\n      textAlign: textElement.text.align.toLowerCase()\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, React.createElement(TextEditor, {\n    defaultValue: textElement.text.value,\n    onSave: function onSave(value) {\n      return props.onUpdate(_objectSpread({}, textElement, {\n        text: _objectSpread({}, textElement.text, {\n          value: value\n        })\n      }));\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  })) : React.createElement(Text, {\n    style: {\n      fontSize: textElement.text.fontSize,\n      textAlign: textElement.text.align.toLowerCase(),\n      border: \"1px solid \".concat(props.selected ? Theme.primary : \"transparent\")\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    },\n    __self: this\n  }, textElement.text.value), props.selected && !props.edit && React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, React.createElement(DragHandle, {\n    onDrag: function onDrag(_ref) {\n      var x = _ref.x,\n          y = _ref.y;\n      props.onUpdate(_objectSpread({}, textElement, {\n        x: textElement.x + x / scale,\n        width: textElement.width - x / scale\n      }));\n    },\n    style: {\n      left: 0,\n      top: \"50%\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }), React.createElement(DragHandle, {\n    onDrag: function onDrag(_ref2) {\n      var x = _ref2.x;\n      props.onUpdate(_objectSpread({}, textElement, {\n        width: Math.max(1, textElement.width + x / scale)\n      }));\n    },\n    style: {\n      top: \"50%\",\n      right: 0\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  })));\n};\nvar BoundingBox =\n/*#__PURE__*/\nstyled(\"div\", {\n  label: \"BoundingBox\",\n  target: \"e10ondmu0\"\n})(\"position:absolute;\");\nvar Text =\n/*#__PURE__*/\nstyled(\"div\", {\n  label: \"Text\",\n  target: \"e10ondmu1\"\n})(\"cursor:pointer;margin:0;font-family:\\\"Montserrat\\\",sans-serif;border:1px solid transparent;background:none;border:none;width:100%;min-height:20px;&:focus{outline:none;}\");","map":{"version":3,"sources":["/Users/andreas/code/reports/app/src/components/ReportEditor/TextElement.tsx"],"names":["React","useState","styled","textElement","Theme","TextEditor","DragHandle","useDrag","TextElement","props","pressed","state","setState","onDragStart","e","x","clientX","y","clientY","onDrag","scale","onUpdate","edit","onDragEnd","onClick","left","top","width","border","primary","selected","id","onDoubleClick","fontSize","text","textAlign","align","toLowerCase","value","Math","max","right","BoundingBox","Text"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport styled from \"react-emotion\";\nimport { textElement } from \"../../models/reports\";\nimport * as Theme from \"../../theme\";\nimport TextEditor from \"../TextEditor\";\nimport { DragHandle } from \"../DragHandle\";\nimport { useDrag } from \"../../hooks/mouse\";\n\ntype pos = {\n  x: number;\n  y: number;\n};\n\ntype BoundingBox = {\n  selected: boolean;\n  edit: boolean;\n  width: number;\n  x: number;\n  y: number;\n};\n\ntype props = {\n  scale: number;\n  textElement: textElement;\n  selected: boolean;\n  edit: boolean;\n  onUpdate: (element: textElement) => void;\n  onClick: () => void;\n  onDoubleClick: () => void;\n};\n\ntype state = {\n  pressed: { x: number; y: number } | null;\n};\n\nexport const TextElement = (props: props) => {\n  const [state, setState] = useState<state>({ pressed: null });\n  const onDragStart = (e: React.MouseEvent<any>) => {\n    setState({\n      pressed: {\n        x: e.clientX,\n        y: e.clientY\n      }\n    });\n  };\n  const onDrag = (e: MouseEvent) => {\n    const { textElement, scale, onUpdate, edit } = props;\n    const { pressed } = state;\n\n    if (!pressed || edit) return;\n\n    const x = (e.clientX - pressed.x) / scale;\n    const y = (e.clientY - pressed.y) / scale;\n    onUpdate({\n      ...textElement,\n      x: textElement.x + x,\n      y: textElement.y + y\n    });\n    setState({\n      pressed: {\n        x: e.clientX,\n        y: e.clientY\n      }\n    });\n  };\n  const onDragEnd = () => {\n    setState({ pressed: null });\n    props.onClick && props.onClick();\n  };\n\n  // const onMouseDown = (e: React.MouseEvent) => {\n  //   const { scale, onClick, edit } = props;\n  //   e.stopPropagation();\n  //   if (edit) return;\n  //   setState({\n  //     pressed: {\n  //       x: e.clientX,\n  //       y: e.clientY\n  //     }\n  //   });\n  //   onClick && onClick();\n  // };\n\n  // const onMouseMove = (e: React.MouseEvent) => {\n  //   const { textElement, scale, onUpdate, edit } = props;\n  //   const { pressed } = state;\n  //   if (!pressed || edit) return;\n  //   const x = (e.clientX - pressed.x) / scale;\n  //   const y = (e.clientY - pressed.y) / scale;\n  //   onUpdate({\n  //     ...textElement,\n  //     x: textElement.x + x,\n  //     y: textElement.y + y\n  //   });\n  //   setState({\n  //     pressed: {\n  //       x: e.clientX,\n  //       y: e.clientY\n  //     }\n  //   });\n  // };\n\n  // useEffect(() => {\n  //   document.addEventListener(\"mouseup\", onMouseUp);\n  //   return () => document.removeEventListener(\"mouseup\", onMouseUp);\n  // });\n\n  const { textElement, scale } = props;\n  return (\n    <BoundingBox\n      style={{\n        left: textElement.x,\n        top: textElement.y,\n        width: textElement.width,\n        border: props.edit\n          ? `1px dashed ${Theme.primary}`\n          : props.selected\n          ? `1px solid ${Theme.primary}`\n          : \"1px solid transparent\"\n      }}\n      key={textElement.id}\n      onDoubleClick={props.onDoubleClick}\n      {...useDrag({ onDragStart, onDragEnd, onDrag })}\n    >\n      {props.edit ? (\n        <Text\n          style={{\n            fontSize: textElement.text.fontSize,\n            textAlign: textElement.text.align.toLowerCase() as any\n          }}\n        >\n          <TextEditor\n            defaultValue={textElement.text.value}\n            onSave={(value) =>\n              props.onUpdate({\n                ...textElement,\n                text: { ...textElement.text, value }\n              })\n            }\n          />\n        </Text>\n      ) : (\n        <Text\n          style={{\n            fontSize: textElement.text.fontSize,\n            textAlign: textElement.text.align.toLowerCase() as any,\n            border: `1px solid ${\n              props.selected ? Theme.primary : \"transparent\"\n            }`\n          }}\n        >\n          {textElement.text.value}\n        </Text>\n      )}\n      {props.selected && !props.edit && (\n        <React.Fragment>\n          <DragHandle\n            onDrag={({ x, y }) => {\n              props.onUpdate({\n                ...textElement,\n                x: textElement.x + x / scale,\n                width: textElement.width - x / scale\n              });\n            }}\n            style={{\n              left: 0,\n              top: \"50%\"\n            }}\n          />\n          <DragHandle\n            onDrag={({ x }) => {\n              props.onUpdate({\n                ...textElement,\n                width: Math.max(1, textElement.width + x / scale)\n              });\n            }}\n            style={{\n              top: \"50%\",\n              right: 0\n            }}\n          />\n        </React.Fragment>\n      )}\n    </BoundingBox>\n  );\n};\n\nconst BoundingBox = styled.div`\n  position: absolute;\n`;\n\nconst Text = styled.div`\n  cursor: pointer;\n  margin: 0;\n  font-family: \"Montserrat\", sans-serif;\n  border: 1px solid transparent;\n  background: none;\n  border: none;\n  width: 100%;\n  min-height: 20px;\n  &:focus {\n    outline: none;\n  }\n`;\n"]},"metadata":{},"sourceType":"module"}
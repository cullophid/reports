{"ast":null,"code":"var _jsxFileName = \"/Users/andreasmoller/code/reports/client/components/Page.tsx\";\nvar __jsx = React.createElement;\nimport { jsx as ___EmotionJSX } from \"@emotion/core\";\nimport ApolloClient, { InMemoryCache } from \"apollo-boost\";\nimport fetch from \"isomorphic-fetch\";\nimport { ApolloProvider } from \"@apollo/react-hooks\";\nimport { useMemo, createContext, useState, useEffect } from \"react\";\nimport React from 'react';\nimport { Global, css } from \"@emotion/core\";\nimport Router from \"next/router\";\nconst globalStyles =\n/*#__PURE__*/\nprocess.env.NODE_ENV === \"production\" ? {\n  name: \"24q28a-globalStyles\",\n  styles: \"html,body,#__next{margin:0;padding:0;height:100%;}a,a:hover,a:visited{text-decoration:none;color:inherit;}label:globalStyles;\"\n} : {\n  name: \"24q28a-globalStyles\",\n  styles: \"html,body,#__next{margin:0;padding:0;height:100%;}a,a:hover,a:visited{text-decoration:none;color:inherit;}label:globalStyles;\",\n  map: \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbmRyZWFzbW9sbGVyL2NvZGUvcmVwb3J0cy9jbGllbnQvY29tcG9uZW50cy9QYWdlLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFRd0IiLCJmaWxlIjoiL1VzZXJzL2FuZHJlYXNtb2xsZXIvY29kZS9yZXBvcnRzL2NsaWVudC9jb21wb25lbnRzL1BhZ2UudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFwb2xsb0NsaWVudCwgeyBPcGVyYXRpb24sIEluTWVtb3J5Q2FjaGUgfSBmcm9tIFwiYXBvbGxvLWJvb3N0XCI7XG5pbXBvcnQgZmV0Y2ggZnJvbSBcImlzb21vcnBoaWMtZmV0Y2hcIjtcbmltcG9ydCB7IEFwb2xsb1Byb3ZpZGVyIH0gZnJvbSBcIkBhcG9sbG8vcmVhY3QtaG9va3NcIjtcbmltcG9ydCB7IFJlYWN0Q2hpbGQsIHVzZU1lbW8sIGNyZWF0ZUNvbnRleHQsIHVzZVN0YXRlLCB1c2VFZmZlY3QgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcbmltcG9ydCB7IEdsb2JhbCwgY3NzIH0gZnJvbSBcIkBlbW90aW9uL2NvcmVcIlxuaW1wb3J0IFJvdXRlciBmcm9tIFwibmV4dC9yb3V0ZXJcIjtcblxuY29uc3QgZ2xvYmFsU3R5bGVzID0gY3NzYFxuICBodG1sLCBib2R5LCAjX19uZXh0IHtcbiAgICBtYXJnaW46MDtcbiAgICBwYWRkaW5nOjA7XG4gICAgaGVpZ2h0OjEwMCU7XG4gIH1cbiAgYSwgYTpob3ZlciwgYTp2aXNpdGVkIHtcbiAgICB0ZXh0LWRlY29yYXRpb246bm9uZTtcbiAgICBjb2xvcjppbmhlcml0O1xuICAgIFxuICB9XG5gXG5cbnR5cGUgUHJvcHMgPSB7XG4gIGNoaWxkcmVuOiBSZWFjdENoaWxkO1xuICByZXF1aXJlQXV0aDogYm9vbGVhblxufVxuXG5jb25zdCBBdXRoQ29udGV4dCA9IGNyZWF0ZUNvbnRleHQ8c3RyaW5nIHwgbnVsbD4odW5kZWZpbmVkKVxuXG5cblxuZXhwb3J0IGNvbnN0IGZldGNoQXV0aFRva2VuID0gYXN5bmMgKCkgPT4ge1xuICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChcIi9hcGkvcmVmcmVzaF90b2tlblwiKVxuICBpZiAocmVzLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgUm91dGVyLnB1c2goXCIvbG9naW5cIilcbiAgfVxuICBjb25zdCB7IGF1dGhfdG9rZW4gfSA9IGF3YWl0IHJlcy5qc29uKClcbiAgY29uc29sZS5sb2coeyBhdXRoX3Rva2VuIH0pXG4gIHJldHVybiBhdXRoX3Rva2VuXG59XG5cbmNvbnN0IGp3dFByb21pc2UgPSBmZXRjaEF1dGhUb2tlbigpXG5cbmV4cG9ydCBjb25zdCBQYWdlID0gKHsgcmVxdWlyZUF1dGgsIGNoaWxkcmVuIH06IFByb3BzKSA9PiB7XG5cbiAgY29uc3QgW2F1dGhUb2tlbiwgc2V0QXV0aFRva2VuXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpXG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBqd3RQcm9taXNlXG4gICAgICAudGhlbihzZXRBdXRoVG9rZW4pXG4gICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICBmZXRjaEF1dGhUb2tlbigpXG4gICAgICAgIC50aGVuKHNldEF1dGhUb2tlbilcbiAgICB9LCA1ICogNjAgKiAxMDAwKVxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjbGVhckludGVydmFsKGludGVydmFsKVxuICAgIH1cbiAgfSwgW10pXG5cblxuICBjb25zdCBhcG9sbG9DbGllbnQgPSB1c2VNZW1vKCgpID0+IG5ldyBBcG9sbG9DbGllbnQoe1xuICAgIHVyaTogXCIvYXBpL2dyYXBocWxcIixcbiAgICByZXF1ZXN0OiBhc3luYyAob3BlcmF0aW9uOiBPcGVyYXRpb24pID0+IHtcbiAgICAgIGlmIChhdXRoVG9rZW4pIHtcbiAgICAgICAgb3BlcmF0aW9uLnNldENvbnRleHQoe1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthdXRoVG9rZW59YFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG4gICAgICB9IGVsc2UgaWYgKHJlcXVpcmVBdXRoKSB7XG4gICAgICAgIGNvbnN0IGF1dGhUb2tlbiA9IGF3YWl0IGp3dFByb21pc2VcbiAgICAgICAgb3BlcmF0aW9uLnNldENvbnRleHQoe1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthdXRoVG9rZW59YFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSxcbiAgICBvbkVycm9yOiAoeyByZXNwb25zZSwgb3BlcmF0aW9uIH0pID0+IHtcbiAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5lcnJvcnMpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihyZXNwb25zZSwgb3BlcmF0aW9uKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGNhY2hlOiBuZXcgSW5NZW1vcnlDYWNoZSh7XG4gICAgICBkYXRhSWRGcm9tT2JqZWN0OiBvYmplY3QgPT4gb2JqZWN0LmlkLFxuICAgIH0pLFxuICAgIGZldGNoLFxuICB9KSwgW2F1dGhUb2tlbl0pXG4gIHJldHVybiAoXG4gICAgPEF1dGhDb250ZXh0LlByb3ZpZGVyIHZhbHVlPXthdXRoVG9rZW59PlxuICAgICAgPEFwb2xsb1Byb3ZpZGVyIGNsaWVudD17YXBvbGxvQ2xpZW50fT5cbiAgICAgICAgPEdsb2JhbCBzdHlsZXM9e2dsb2JhbFN0eWxlc30gLz5cbiAgICAgICAge2NoaWxkcmVufVxuICAgICAgPC9BcG9sbG9Qcm92aWRlciA+XG4gICAgPC9BdXRoQ29udGV4dC5Qcm92aWRlcj5cbiAgKVxufVxuIl19 */\"\n};\nconst AuthContext = createContext(undefined);\nexport const fetchAuthToken = async () => {\n  const res = await fetch(\"/api/refresh_token\");\n\n  if (res.status !== 200) {\n    Router.push(\"/login\");\n  }\n\n  const {\n    auth_token\n  } = await res.json();\n  console.log({\n    auth_token\n  });\n  return auth_token;\n};\nconst jwtPromise = fetchAuthToken();\nexport const Page = ({\n  requireAuth,\n  children\n}) => {\n  const {\n    0: authToken,\n    1: setAuthToken\n  } = useState(null);\n  useEffect(() => {\n    jwtPromise.then(setAuthToken);\n    const interval = setInterval(() => {\n      fetchAuthToken().then(setAuthToken);\n    }, 5 * 60 * 1000);\n    return () => {\n      clearInterval(interval);\n    };\n  }, []);\n  const apolloClient = useMemo(() => new ApolloClient({\n    uri: \"/api/graphql\",\n    request: async operation => {\n      if (authToken) {\n        operation.setContext({\n          headers: {\n            Authorization: `Bearer ${authToken}`\n          }\n        });\n      } else if (requireAuth) {\n        const authToken = await jwtPromise;\n        operation.setContext({\n          headers: {\n            Authorization: `Bearer ${authToken}`\n          }\n        });\n      }\n    },\n    onError: ({\n      response,\n      operation\n    }) => {\n      if (response && response.errors) {\n        console.error(response, operation);\n      }\n    },\n    cache: new InMemoryCache({\n      dataIdFromObject: object => object.id\n    }),\n    fetch\n  }), [authToken]);\n  return ___EmotionJSX(AuthContext.Provider, {\n    value: authToken,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89\n    },\n    __self: this\n  }, ___EmotionJSX(ApolloProvider, {\n    client: apolloClient,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90\n    },\n    __self: this\n  }, ___EmotionJSX(Global, {\n    styles: globalStyles,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91\n    },\n    __self: this\n  }), children));\n};","map":{"version":3,"sources":["/Users/andreasmoller/code/reports/client/components/Page.tsx"],"names":["ApolloClient","InMemoryCache","fetch","ApolloProvider","useMemo","createContext","useState","useEffect","React","Global","css","Router","globalStyles","AuthContext","undefined","fetchAuthToken","res","status","push","auth_token","json","console","log","jwtPromise","Page","requireAuth","children","authToken","setAuthToken","then","interval","setInterval","clearInterval","apolloClient","uri","request","operation","setContext","headers","Authorization","onError","response","errors","error","cache","dataIdFromObject","object","id"],"mappings":"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","sourcesContent":["import ApolloClient, { Operation, InMemoryCache } from \"apollo-boost\";\nimport fetch from \"isomorphic-fetch\";\nimport { ApolloProvider } from \"@apollo/react-hooks\";\nimport { ReactChild, useMemo, createContext, useState, useEffect } from \"react\";\nimport React from 'react'\nimport { Global, css } from \"@emotion/core\"\nimport Router from \"next/router\";\n\nconst globalStyles = css`\n  html, body, #__next {\n    margin:0;\n    padding:0;\n    height:100%;\n  }\n  a, a:hover, a:visited {\n    text-decoration:none;\n    color:inherit;\n    \n  }\n`\n\ntype Props = {\n  children: ReactChild;\n  requireAuth: boolean\n}\n\nconst AuthContext = createContext<string | null>(undefined)\n\n\n\nexport const fetchAuthToken = async () => {\n  const res = await fetch(\"/api/refresh_token\")\n  if (res.status !== 200) {\n    Router.push(\"/login\")\n  }\n  const { auth_token } = await res.json()\n  console.log({ auth_token })\n  return auth_token\n}\n\nconst jwtPromise = fetchAuthToken()\n\nexport const Page = ({ requireAuth, children }: Props) => {\n\n  const [authToken, setAuthToken] = useState<string | null>(null)\n\n  useEffect(() => {\n    jwtPromise\n      .then(setAuthToken)\n    const interval = setInterval(() => {\n      fetchAuthToken()\n        .then(setAuthToken)\n    }, 5 * 60 * 1000)\n    return () => {\n      clearInterval(interval)\n    }\n  }, [])\n\n\n  const apolloClient = useMemo(() => new ApolloClient({\n    uri: \"/api/graphql\",\n    request: async (operation: Operation) => {\n      if (authToken) {\n        operation.setContext({\n          headers: {\n            Authorization: `Bearer ${authToken}`\n          },\n        })\n      } else if (requireAuth) {\n        const authToken = await jwtPromise\n        operation.setContext({\n          headers: {\n            Authorization: `Bearer ${authToken}`\n          },\n        })\n      }\n    },\n    onError: ({ response, operation }) => {\n      if (response && response.errors) {\n        console.error(response, operation);\n      }\n    },\n    cache: new InMemoryCache({\n      dataIdFromObject: object => object.id,\n    }),\n    fetch,\n  }), [authToken])\n  return (\n    <AuthContext.Provider value={authToken}>\n      <ApolloProvider client={apolloClient}>\n        <Global styles={globalStyles} />\n        {children}\n      </ApolloProvider >\n    </AuthContext.Provider>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}
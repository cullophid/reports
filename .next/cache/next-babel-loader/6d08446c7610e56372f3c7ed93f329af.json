{"ast":null,"code":"import { AuthenticationError } from \"apollo-server-core\";\nexport const Query = {\n  currentUser: ({}, {}, ctx) => {\n    if (!ctx.session.user) {\n      throw new AuthenticationError(\"You are not authenticated\");\n    }\n\n    return ctx.photon.users.findOne({\n      where: {\n        id: ctx.session.user.sub\n      }\n    });\n  },\n  reports: (_, {}, ctx) => {\n    if (!ctx.session.user) {\n      throw new AuthenticationError(\"You must be authenticated\");\n    }\n\n    return ctx.photon.users.findOne({\n      where: {\n        id: ctx.session.user.sub\n      }\n    }).reports();\n  },\n  report: async (_, {\n    id\n  }, ctx) => {\n    const {\n      user\n    } = ctx.session;\n\n    if (!user) {\n      throw new AuthenticationError(\"You are not authenticated\");\n    }\n\n    const [report] = await ctx.photon.reports.findMany({\n      where: {\n        id,\n        owner: {\n          id: user.sub\n        }\n      }\n    });\n\n    if (!report) {\n      throw new Error(\"Could not find a report with that id\");\n    }\n\n    return report;\n  }\n};","map":{"version":3,"sources":["/Users/andreasmoller/code/reports/server/resolvers/Query.ts"],"names":["AuthenticationError","Query","currentUser","ctx","session","user","photon","users","findOne","where","id","sub","reports","_","report","findMany","owner","Error"],"mappings":"AACA,SAASA,mBAAT,QAAoC,oBAApC;AAGA,OAAO,MAAMC,KAAqB,GAAG;AACnCC,EAAAA,WAAW,EAAE,CAAC,EAAD,EAAM,EAAN,EAAWC,GAAX,KAAmB;AAC9B,QAAI,CAACA,GAAG,CAACC,OAAJ,CAAYC,IAAjB,EAAuB;AACrB,YAAM,IAAIL,mBAAJ,CAAwB,2BAAxB,CAAN;AACD;;AACD,WAAOG,GAAG,CAACG,MAAJ,CAAWC,KAAX,CAAiBC,OAAjB,CAAyB;AAC9BC,MAAAA,KAAK,EAAE;AACLC,QAAAA,EAAE,EAAEP,GAAG,CAACC,OAAJ,CAAYC,IAAZ,CAAiBM;AADhB;AADuB,KAAzB,CAAP;AAKD,GAVkC;AAWnCC,EAAAA,OAAO,EAAE,CAACC,CAAD,EAAI,EAAJ,EAASV,GAAT,KAAiB;AACxB,QAAI,CAACA,GAAG,CAACC,OAAJ,CAAYC,IAAjB,EAAuB;AACrB,YAAM,IAAIL,mBAAJ,CAAwB,2BAAxB,CAAN;AACD;;AACD,WAAOG,GAAG,CAACG,MAAJ,CAAWC,KAAX,CAAiBC,OAAjB,CAAyB;AAC9BC,MAAAA,KAAK,EAAE;AACLC,QAAAA,EAAE,EAAEP,GAAG,CAACC,OAAJ,CAAYC,IAAZ,CAAiBM;AADhB;AADuB,KAAzB,EAIJC,OAJI,EAAP;AAKD,GApBkC;AAqBnCE,EAAAA,MAAM,EAAE,OAAOD,CAAP,EAAU;AAAEH,IAAAA;AAAF,GAAV,EAAkBP,GAAlB,KAA0B;AAChC,UAAM;AAAEE,MAAAA;AAAF,QAAWF,GAAG,CAACC,OAArB;;AACA,QAAI,CAACC,IAAL,EAAW;AACT,YAAM,IAAIL,mBAAJ,CAAwB,2BAAxB,CAAN;AACD;;AAED,UAAM,CAACc,MAAD,IAAW,MAAMX,GAAG,CAACG,MAAJ,CAAWM,OAAX,CAAmBG,QAAnB,CAA4B;AACjDN,MAAAA,KAAK,EAAE;AACLC,QAAAA,EADK;AAELM,QAAAA,KAAK,EAAE;AACLN,UAAAA,EAAE,EAAEL,IAAI,CAACM;AADJ;AAFF;AAD0C,KAA5B,CAAvB;;AAQA,QAAI,CAACG,MAAL,EAAa;AACX,YAAM,IAAIG,KAAJ,CAAU,sCAAV,CAAN;AACD;;AACD,WAAOH,MAAP;AACD;AAvCkC,CAA9B","sourcesContent":["import { QueryResolvers } from \"../codegen/graphql\";\nimport { AuthenticationError } from \"apollo-server-core\";\nimport { encodeXText } from \"nodemailer/lib/shared\";\n\nexport const Query: QueryResolvers = {\n  currentUser: ({ }, { }, ctx) => {\n    if (!ctx.session.user) {\n      throw new AuthenticationError(\"You are not authenticated\")\n    }\n    return ctx.photon.users.findOne({\n      where: {\n        id: ctx.session.user.sub\n      }\n    })\n  },\n  reports: (_, { }, ctx) => {\n    if (!ctx.session.user) {\n      throw new AuthenticationError(\"You must be authenticated\")\n    }\n    return ctx.photon.users.findOne({\n      where: {\n        id: ctx.session.user.sub\n      }\n    }).reports();\n  },\n  report: async (_, { id }, ctx) => {\n    const { user } = ctx.session\n    if (!user) {\n      throw new AuthenticationError(\"You are not authenticated\")\n    }\n\n    const [report] = await ctx.photon.reports.findMany({\n      where: {\n        id,\n        owner: {\n          id: user.sub\n        }\n      }\n    })\n    if (!report) {\n      throw new Error(\"Could not find a report with that id\")\n    }\n    return report\n  }\n}"]},"metadata":{},"sourceType":"module"}